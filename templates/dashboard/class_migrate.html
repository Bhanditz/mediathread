{% extends "dashboard/base_dashboard.html" %}
{% block title %}Migrate Course Materials{% endblock %}

{% block js %}
    {{ block.super }}
    
    <script type="text/javascript"> 
        var courses =
            [{% for c in available_courses %}
                {% ifnotequal c.id request.course.id %}
                    { label: "{{c.title}}",
                      value: "{{c.title}}",
                      id: "{{c.id}}",
                      faculty_string: "{% for u in c.faculty %}{{u.id}}{% if forloop.last %}{% else %},{% endif %}{% endfor %}"  
                    }
                    {% if forloop.last %}{% else %},{% endif %}
                {% endifnotequal %}
            {% endfor %}];
        
        
        jQuery(document).ready(function () {
            var view = new CourseMaterialsView({ availableCourses: courses, el: "li.archive-container" });
        });

    </script>
    
    <script type="text/javascript" src="/site_media/js/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="/site_media/js/backbone/backbone-min.js"></script>
    <script type="text/javascript" src="/site_media/js/backbone/backbone-tastypie.js"></script>
    <script type="text/javascript" src="/site_media/jquery/js/jquery.masonry.min.js"></script>        
    <script type="text/javascript" src="/site_media/js/instructor/class_migrate.js"></script>
    
    <script type="text/template" id="projects-template">
        <h1><%= title %></h1>
    </script>
    
    <script type="text/template" id="items-template">
        <h1><%= title %></h1>
    </script>
    
    <script type="text/template" id="course-template">
        <h1><%= title %></h1>
        <% if (info && info.term) { %> 
            <p><b>Term:</b> <% if (info.term === 1) { %>
                    Spring 
                  <% } else if (info.term === 2) { %>
                    Summer
                  <% } else if (info.term === 3) { %>
                    Fall
                  <% } %></p>
        <% } %>
        <% if (info && info.year) { %>
            <p><b>Year:</b> <%= info.year %></p>
        <% } %>
        <p><b>Faculty:</b>
            <% for (var i = 0; i < faculty_group.user_set.length; i++) { %>
                <%= faculty_group.user_set[i].full_name %><% if (i < faculty_group.user_set.length-1) { %>, <% } %>
            <% } %></p>

        <input id="import-all" type="button" value="Import Complete Course">
        <div id="import-all-dialog" style="display: none" title="Import">
            <h3><%= title %></h3>
            <% if (project_set && project_set.length > 0) { %>
                <div><%= project_set.length %> Projects with <%= project_set.total_sherdnotes() %> referenced items</div>
            <% } else { %>
                <div>No projects</div>
            <% } %>
            <% if (asset_set && asset_set.length > 0) { %>
                <div><%= asset_set.length %> items and <%= asset_set.total_sherdnotes()  %> selections</div>
            <% } else { %>
                <div>No items or selections</div>
            <% } %>
            <br />
            <div>Are you sure you want to import this entire course?</div>                                                              
        </div> 
        <br /><br />
        <% if (project_set && project_set.length > 0) { %>
            <div><%= project_set.length %> Projects with <%= project_set.total_sherdnotes() %> referenced items</div>
            <div><input id="import-projects" type="button" value="Select Projects To Import"></div>
            <div id="import-projects-dialog" class="import-dialog" style="display: none" title="Select Projects To Import">
                <i>Note: Items and selections associated with a project are automatically migrated</i>
                <div class="right"><a href="#" id="select-all-projects">Select All</a> | <a href="#" id="clear-all-projects">Clear All</a></div>
                <div class="visualclear"/>
                <div class="import-stuff">
                <table>
                <% for (var i = 0; i < project_set.length; i++) { %>
                    <% var project = project_set.at(i) %>
                    <tr <% if (i % 2 === 0) { %> class="odd" <% } %> >
                        <td class="title"><b>
                            <% if (project.get('is_assignment')) { %>
                                Assignment:                             
                            <% } %>
                            <%= project.get('title') %></b><br />
                            by <%= project.get('attribution') %>
                            
                            <% if (project.get('sherdnote_set').length > 0) { %>
                                <br />
                                <i>Includes <%= project.get('sherdnote_set').length %> selections</i>
                            <% } %>
                        </td>
                        <td><input class="project" type="checkbox" value="<%= project.get('id') %>"/></td>
                    </tr>
                <% } %>
                </table>
                </div>                
            </div>
        <% } %>
        <br /><br />

        <% if (asset_set && asset_set.length > 0) { %>             
            <div><%= asset_set.length %> Items with <%= asset_set.total_sherdnotes() %> Selections</div>
            <div><input id="import-items" type="button" value="Select Items To Import"></div>

            <div id="import-items-dialog" class="import-dialog import-items-dialog" style="display: none" title="Select Items To Import">
            <div class="right"><a href="#" id="select-all-items">Select All</a> | <a href="#" id="clear-all-items">Clear All</a></div>
            <div class="visualclear"/>
            <% for (var j = 0; j < asset_set.length; j++) { %>
                <% var asset = asset_set.at(j) %>
                <div class="gallery-item rounded gallery-item-mini <%= asset.get('required') %>">                    
                    <h4 class="asset_title asset-<%=asset.get('primary_type') %>">
                        <input class="right <%=asset.get('required') %>" type="checkbox" value="<%= asset.get('id') %>"
                            <% if (asset.get('required') === "required") { %> disabled="disabled" checked="checked" <% } %> 
                        />
                        <div class="title"><%= asset.get('title') %></div>
                    </h4>
                    <% if (asset.get('thumb_url')) { %>
                        <div class="record">
                            <img class="asset-thumb" src="<%=asset.get('thumb_url') %>" alt="Item Thumbnail" />
                        </div>
                    <% } %>
                    <div class="meta">
                        <div class="metadata-value">Imported by <%= asset.get('author').full_name %></div>
                        <div>
                            <span class="metadata-value">Includes </span>  
                            <span class="metadata-label item-annotation-count-total"><%=asset.get('sherdnote_set').length %></span>
                            <span class="metadata-value">selections</span>                        
                        </div>
                    </div>
                    
                </div>
            <% } %>
            </div>
        <% } %>
    </script>
{% endblock %}

{% block dashboard_module %}
    {% with "help_migrate_materials" as help_id %}
    {% with help_migrate_materials as default_help_state %}
    
    <ul class="archive-gallery">
        <li class="archive-container">
            <h2>Migrate Course Materials {% include "help/help_button.html" %}</h2>
            {% include "help/help_contentarea.html" %}
            
            <div id="no-materials-to-migrate" style="display: none">
                You are not affiliated with any other courses. Please review our help materials
                if you need to migrate course materials from a colleague's class.
            </div>
            
            <div id="available-courses-selector" style="display: none">
                <input type="text" class="default" id="available-courses" value="Type course name here">
                <input type="submit" id="view-materials" value="View materials" />
            </div>
                
            <div id="course-materials-container" style="display: none">                
                <div class="left half">
                    <div id="course"></div>
                </div>
                <div class="selected-for-import" style="display: none">
                    <form>
                        <div><h4 class="left">Selected for import</h4><h4 class="right">Remove</h4></div>
                        <div class="visualclear"/>
                        <div id="to_import" class="results scroll">
                        </div>
                        <input type="button" value="Import Selected" />
                    </form>
                </div>                    
            </div>
            
            
        </li>
    </ul>
    
    {% endwith %}{% endwith %}

{% endblock %}



