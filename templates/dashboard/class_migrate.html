{% extends "dashboard/base_dashboard.html" %}
{% block title %}Migrate Course Materials{% endblock %}

{% block js %}
    {{ block.super }}
    
    <script type="text/javascript"> 
        var courses =
            [{% for c in available_courses %}
                {% ifnotequal c.id request.course.id %}
                    { label: "{{c.title}}", value: "{{c.title}}", id: "{{c.id}}" }{% if forloop.last %}{% else %},{% endif %}
                {% endifnotequal %}
            {% endfor %}];
        
        
        jQuery(document).ready(function () {
            var view = new CourseMaterialsView({ availableCourses: courses, el: "li.archive-container" });
        });

    </script>
    
    <script type="text/javascript" src="/site_media/js/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="/site_media/js/backbone/backbone-min.js"></script>
    <script type="text/javascript" src="/site_media/js/backbone/backbone-tastypie.js"></script>
    <script type="text/javascript" src="/site_media/jquery/js/jquery.masonry.min.js"></script>        
    <script type="text/javascript" src="/site_media/js/instructor/class_migrate.js"></script>
    
    <script type="text/template" id="projects-template">
        <h1><%= title %></h1>
    </script>
    
    <script type="text/template" id="items-template">
        <h1><%= title %></h1>
    </script>
    
    <script type="text/template" id="course-template">
        <h1><%= title %></h1>
        <% if (info && info.term) { %> 
            <p><b>Term:</b> <% if (info.term === 1) { %>
                    Spring 
                  <% } else if (info.term === 2) { %>
                    Summer
                  <% } else if (info.term === 3) { %>
                    Fall
                  <% } %></p>
        <% } %>
        <% if (info && info.year) { %>
            <p><b>Year:</b> <%= info.year %></p>
        <% } %>
        <p><b>Faculty:</b>  
            <% for (var i = 0; i < faculty_group.user_set.length; i++) { %>
                <%= faculty_group.user_set[i].full_name %><% if (i < faculty_group.user_set.length-1) { %>, <% } %>
            <% } %></p>

        <input id="import-all" type="button" value="Import Complete Course">
        <div id="import-all-dialog" style="display: none" title="Import">
            <h3><%= title %></h3>
            <div><%= project_set.length %> Projects with <%= project_set_selections %> associated items and selections</div>
            <div>x items and 26 selections</div>
            <br />
            <div>Are you sure you want to import this entire course?</div>                                                              
        </div> 
        <br /><br />
        <% if (project_set && project_set.length > 0) { %>
            <div><%= project_set.length %> Projects</div>
            <div><input id="import-projects" type="button" value="Select Projects To Import"></div>
            <div id="import-projects-dialog" class="import-dialog" style="display: none" title="Select Projects To Import">
                <i>Note: Items and selections associated with a project are automatically migrated</i>
                <div class="import-stuff">
                <table>
                <% for (var i = 0; i < project_set.length; i++) { %>
                    <tr <% if (i % 2 === 0) { %> class="odd" <% } %> >
                        <td class="title"><b>
                            <% if (project_set[i].is_assignment) { %>
                                Assignment:                             
                            <% } %>
                            <%= project_set[i].title %></b><br />
                            by <%= project_set[i].attribution %>
                            
                            <% if (project_set[i].selection_count > 0) { %>
                                <br />
                                <i>Includes <%= project_set[i].selection_count %> items and selections</i>
                            <% } %>
                        </td>
                        <td><input type="checkbox" value="<%= project_set[i].id %>"/></td>
                    </tr>
                <% } %>
                </table>
                </div>                
            </div>
        <% } %>
        <br /><br />

        <% if (item_set && item_set.length > 0) { %>
            <div><%= item_set.length %> Items with X Selections</div>
            <div><input id="import-items" type="button" value="Select Items To Import"></div>

            <div id="import-items-dialog" class="import-dialog import-items-dialog" style="display: none" title="Select Items To Import">
            <% for (var i = 0; i < item_set.length; i++) { %>
                <div class="gallery-item rounded gallery-item-mini">                    
                    <h4 class="asset_title asset-<%=item_set[i].primary_type%>"><input class="right" type="checkbox" value="<%= item_set[i].id %>"/><div class="title"><%= item_set[i].title %></div></h4>
                    <% if (item_set[i].thumb_url) { %>
                        <div class="record">
                            <img class="asset-thumb" src="<%=item_set[i].thumb_url%>" alt="Item Thumbnail" />
                        </div>
                    <% } %>
                </div>
            <% } %>
            </div>
        <% } %>
    </script>
{% endblock %}

{% block dashboard_module %}
    {% with "help_migrate_materials" as help_id %}
    {% with help_migrate_materials as default_help_state %}
    
    <ul class="archive-gallery">
        <li class="archive-container">                
            <h2>Migrate Course Materials {% include "help/help_button.html" %}</h2>
            {% include "help/help_contentarea.html" %}
            
            <div id="no-materials-to-migrate" style="display: none">
                You are not affiliated with any other courses. Please review our help materials
                if you need to migrate course materials from a colleague's class.
            </div>
            
            <div id="available-courses-selector" style="display: none">
                <input type="text" class="default" id="available-courses" value="Type course name here">
                <input type="submit" id="view-materials" value="View materials" />
            </div>
                
            <div id="course-materials-container" style="display: none">                
                <div class="left half">
                    <div id="course"></div>
                </div>
                <div class="selected-for-import" style="display: none">
                    <div><h4 class="left">Selected for import</h4><h4 class="right">Remove</h4></div>
                    <div class="visualclear"/>
                    <div class="results scroll"></div>
                    <input type="button" value="Import Selected" />
                </div>                    
            </div>
        </li>
    </ul>
    
    {% endwith %}{% endwith %}

{% endblock %}



